%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       filter to 0.5-75Hz, get PSD,DE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% english psd de
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% path = 'G:\drn\thesis\data\english\raw_data';
% path_fea = 'G:\drn\thesis\data\english\feature_new_de';
% fileList={...
%     'caoyang_20130505','caoyang_20130523','duanruonan_20130602','duanruonan_20130606',...
%     'lichenguang_20130505','lichenguang_20130517','luolujin_20130504','luolujin_20130517',...
%     'meijincheng_20130602','meijincheng_20130609','zhengweilong_20130504','zhengweilong_20130522'};
% fileNum = length(fileList);
% stft_para.stftn = 256;
% stft_para.fs = 200;
% stft_para.fStart = [1,4,8,14,31];
% stft_para.fEnd = [4,8,14,31,50];
% stft_para.window = 1 ;
% for i=1:fileNum
%     filename = fileList{i};
%     file = sprintf('%s\\%s.mat', path, filename);
%     fea_file = sprintf('%s\\%s.mat', path_fea,filename);
%     disp(sprintf('processing %s ...\n', file));
%     load (file);
%     for j = 1:12
%         eval(['signal','=','eeg',num2str(j),';']);
%         signal = eegfilt(signal, 200, 0.5, 75);
%         [psd,de] = STFT(signal, stft_para);
%         eval(['psd',num2str(j),'=','psd;']);
%         eval(['de',num2str(j),'=','de;']);
%         if exist(fea_file,'file') == 0
%             eval(['save',' ',fea_file,' psd',num2str(j),';']);
%         else
%             eval(['save',' -append ',fea_file,' psd',num2str(j),';']);
%         end
%         eval(['save',' -append ',fea_file,' de',num2str(j),';']);
%     end
% end

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% chinese psd de
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

path = 'G:\zwl\Emotion\data\chinese\raw_data';
path_fea = 'E:\Lab\Data\EEG_eye_emotion3\EEG_split';
fileList={...
    'dujingcheng_20131027','dujingcheng_20131030','dujingcheng_20131107',...
    'mahaiwei_20130712','mahaiwei_20131016','mahaiwei_20131113',...
    'penghuiling_20131027','penghuiling_20131030','penghuiling_20131106',...
    'zhujiayi_20130709','zhujiayi_20131016','zhujiayi_20131105',...
    'wuyangwei_20131127','wuyangwei_20131201','wuyangwei_20131207',...
    'weiwei_20131130','weiwei_20131204','weiwei_20131211',...
    'jianglin_20140404','jianglin_20140413','jianglin_20140419',...
    'liuye_20140411','liuye_20140418','liuye_20140506','liuye_20140516',...
    'sunxiangyu_20140511','sunxiangyu_20140514','sunxiangyu_20140521',...
    'xiayulu_20140527','xiayulu_20140603','xiayulu_20140610',...
    'jingjing_20140603','jingjing_20140611','jingjing_20140616','jingjing_20140629',...
    'yansheng_20140601','yansheng_20140615','yansheng_20140622','yansheng_20140627',...
    'wusifan_20140618','wusifan_20140625','wusifan_20140630',...
    'wangkui_20140620','wangkui_20140627','wangkui_20140704',...
    'liuqiujun_20140621','liuqiujun_20140629','liuqiujun_20140702','liuqiujun_20140705',...
    };
shortNameList={...
    'djc','djc','djc',...
    'mhw','mhw','mhw',...
    'phl','phl','phl',...
    'zjy','zjy','zjy',...
    'wyw','wyw','wyw',...
    'ww','ww','ww',...
    'jl','jl','jl',...
    'ly','ly','ly','ly',...
    'sxy','sxy','sxy',...
    'xyl','xyl','xyl',...
    'jj','jj','jj','jj',...
    'ys','ys','ys','ys',...
    'wsf','wsf','wsf',...
    'wk','wk','wk',...
    'lqj','lqj','lqj','lqj'
};
fileNum = length(fileList);
stft_para.stftn = 256; % frequency domain sampling rate
stft_para.fs = 200; % original rate
stft_para.fStart = [1,4,8,14,31];
stft_para.fEnd = [4,8,14,31,50];
stft_para.window = 1 ;
for i=1:fileNum
    filename = fileList{i};
    file = sprintf('%s\\%s.mat', path, filename);
    fea_file = sprintf('%s\\%s.mat', path_fea,filename);
    disp(sprintf('processing %s ...\n', file));
    load (file);
    short_name = shortNameList{i};
    for j = 1:15
%       eval(['signal','= eeg_',num2str(j),';']);
        eval(['signal','=',short_name, '_eeg',num2str(j),';']);
        % eeg signal filter 
        signal = eegfilt(signal, 200, 0, 75);
        [psd,de] = STFT(signal, stft_para);
        eval(['psd',num2str(j),'=','psd;']);
        eval(['de',num2str(j),'=','de;']);
        if exist(fea_file,'file') == 0
            eval(['save',' ',fea_file,' psd',num2str(j),';']);
        else
            eval(['save',' -append ',fea_file,' psd',num2str(j),';']);
        end
        eval(['save',' -append ',fea_file,' de',num2str(j),';']);
    end
    clearvars -except stft_para fileNum path path_fea fileList shortNameList;
end


